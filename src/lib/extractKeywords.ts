/**
 * Korean keyword extraction utility
 * Extracts and counts keywords from Korean text
 * 
 * Comprehensive stopwords list to filter out meaningless conversational words
 * and surface truly meaningful content keywords for trending
 */

// Common Korean stopwords to filter out
const STOPWORDS = new Set([
    // ============================================
    // 조사 (Particles)
    // ============================================
    '은', '는', '이', '가', '을', '를', '의', '에', '에서', '로', '으로', '와', '과', '도', '만', '까지',
    '에게', '한테', '께', '부터', '처럼', '같이', '보다', '마다', '대로', '밖에', '뿐', '따라',
    '이랑', '랑', '하고', '이나', '나', '든지', '이든지', '마저', '조차', '야', '이야',
    '요', '이요', '라고', '이라고', '라는', '이라는', '라면', '이라면',

    // ============================================
    // 접속사 및 연결어 (Conjunctions & Connectors)
    // ============================================
    '그리고', '하지만', '그러나', '그래서', '그러면', '또는', '혹은', '및', '더불어', '또한', '게다가',
    '그런데', '그래도', '그렇지만', '그러니까', '그러니', '따라서', '왜냐하면', '때문에',
    '그러므로', '결국', '결론적으로', '마찬가지로', '반면에', '반면', '오히려', '차라리',
    '물론', '사실', '실제로', '아무튼', '어쨌든', '하여튼', '아무래도', '어차피',
    '그래야', '그래가지고', '근데', '근데요', '그랬는데', '그랬더니',

    // ============================================
    // 대명사 (Pronouns)
    // ============================================
    '나', '너', '우리', '저', '저희', '제', '제가', '저는', '나는', '내가',
    '저도', '나도', '우리도', '저희도', '너도', '제게', '저에게', '나에게', '내게',
    '여러분', '여러분은', '여러분도', '여러분이', '여러분의', '여러분께',
    '자신', '자기', '본인', '스스로', '서로',
    '이것', '그것', '저것', '여기', '거기', '저기', '이런', '그런', '저런',
    '이거', '그거', '저거', '이게', '그게', '저게', '이건', '그건', '저건',
    '무엇', '어디', '언제', '누구', '어떤', '어떻게', '왜', '뭐', '뭘', '뭔가',
    '이쪽', '그쪽', '저쪽', '어느', '이곳', '그곳', '저곳',

    // ============================================
    // 시간 표현 (Time Expressions)
    // ============================================
    '지금', '현재', '오늘', '내일', '어제', '모레', '그제', '올해', '작년', '내년',
    '요즘', '최근', '예전', '예전에', '전에', '이전에', '나중에', '다음에', '앞으로',
    '처음', '처음에', '처음엔', '마지막', '마지막에', '마지막으로', '끝에', '끝으로',
    '항상', '언제나', '늘', '자주', '가끔', '때때로', '종종', '매번', '매일', '매주', '매달', '매년',
    '잠시', '잠깐', '금방', '바로', '곧', '이미', '벌써', '아직', '여전히', '계속', '계속해서',
    '드디어', '마침내', '결국', '이때', '그때', '그동안', '한동안', '얼마간', '오래', '오랫동안',
    '당시', '순간', '동시에', '이후', '이전', '동안', '사이',

    // ============================================
    // 부사 (Adverbs)
    // ============================================
    '정말', '진짜', '참', '매우', '아주', '너무', '굉장히', '엄청', '엄청나게', '상당히', '꽤',
    '조금', '좀', '약간', '다소', '살짝', '겨우', '간신히', '거의', '대략', '대충',
    '많이', '더', '덜', '더욱', '훨씬', '가장', '제일', '특히', '주로', '대부분', '대개',
    '완전', '완전히', '전혀', '절대', '절대로', '도저히', '결코', '과연', '역시',
    '아마', '아마도', '혹시', '설마', '분명', '분명히', '확실히', '틀림없이',
    '그냥', '단지', '단순히', '그저', '오직', '바로', '직접', '즉시', '당장',
    '함께', '같이', '따로', '별로', '별도로', '각각', '모두', '다', '전부', '싹', '죄다',
    '빨리', '천천히', '급히', '서서히', '점점', '갑자기', '자연스럽게', '자연히',
    '먼저', '우선', '일단', '나중', '마침', '마침내', '드디어',
    '심지어', '게다가', '더구나', '더욱이', '하물며', '오히려', '차라리', '도리어',

    // ============================================
    // 일반 동사/형용사 및 활용형 (Common Verbs/Adjectives & Conjugations)
    // ============================================
    // 기본형
    '있다', '없다', '하다', '되다', '이다', '아니다', '같다', '다르다',
    '보다', '가다', '오다', '알다', '모르다', '주다', '받다', '만들다',
    '보이다', '들리다', '느끼다', '생기다', '나오다', '들어가다',

    // 현재형
    '있는', '없는', '하는', '되는', '같은', '다른',
    '있습니다', '없습니다', '합니다', '됩니다', '입니다', '아닙니다', '같습니다',
    '있어요', '없어요', '해요', '돼요', '이에요', '예요', '아니에요', '같아요',
    '있어', '없어', '해', '돼', '야', '이야', '아니야', '같아',

    // 과거형
    '있었', '없었', '했다', '됐다', '였다', '이었다', '같았다',
    '있었어요', '없었어요', '했어요', '됐어요', '이었어요', '같았어요',
    '있었습니다', '없었습니다', '했습니다', '됐습니다', '이었습니다',

    // 미래/추측형
    '있을', '없을', '할', '될', '일', '같을',
    '있겠', '없겠', '하겠', '되겠', '이겠', '같겠',

    // 의문형
    '있나요', '없나요', '하나요', '되나요', '인가요', '같나요',
    '있니', '없니', '하니', '되니', '이니', '같니',
    '있을까요', '없을까요', '할까요', '될까요', '일까요', '같을까요',
    '있을까', '없을까', '할까', '될까', '일까', '같을까',

    // 존칭형
    '있으신', '없으신', '하신', '되신', '이신', '같으신',
    '있으신가요', '없으신가요', '하신가요', '되신가요', '이신가요',
    '있으세요', '없으세요', '하세요', '되세요', '이세요', '같으세요',
    '있으시면', '없으시면', '하시면', '되시면', '이시면',
    '계신', '계시는', '계세요', '계십니다', '계신가요',

    // 연결형
    '있고', '없고', '하고', '되고', '이고',
    '있으면', '없으면', '하면', '되면', '이면', '같으면',
    '있어서', '없어서', '해서', '돼서', '이어서', '같아서',
    '있으니', '없으니', '하니', '되니', '이니', '같으니',
    '있는데', '없는데', '하는데', '되는데', '인데', '같은데',
    '있지만', '없지만', '하지만', '되지만', '이지만', '같지만',

    // 명령/청유형
    '하세요', '하십시오', '해라', '하자', '합시다', '해봐', '해봐요', '해보세요',

    // 추측/가능형
    '있을지', '없을지', '할지', '될지', '일지', '같을지',
    '있나', '없나', '하나', '되나', '인가', '같나',

    // ============================================
    // 보조 용언 (Auxiliary Verbs)
    // ============================================
    '보다', '주다', '버리다', '놓다', '두다', '가다', '오다', '내다', '대다',
    '보고', '주고', '버리고', '해보고', '해주고',
    '봤다', '줬다', '버렸다', '해봤다', '해줬다',
    '보니', '보니까', '보면', '보면서', '보는', '보게',

    // ============================================
    // 경험/경력 표현 (Experience Expressions)
    // ============================================
    '적이', '적도', '적은', '적에', '적이요', '적이에요',
    '경험이', '경험을', '경험한', '경험해', '경험했',

    // ============================================
    // 수식어 및 정도 표현 (Modifiers & Degree)
    // ============================================
    '것', '거', '수', '등', '더', '덜', '또', '다시',
    '새로운', '다른', '같은', '어떤', '이런', '그런', '저런', '어느', '모든', '각',
    '좋은', '나쁜', '큰', '작은', '많은', '적은', '높은', '낮은', '긴', '짧은',
    '새', '헌', '이번', '저번', '다음', '이전', '마지막', '첫', '첫번째', '두번째',

    // ============================================
    // 보조 표현 (Auxiliary Expressions)
    // ============================================
    '위해', '위해서', '대한', '대해', '대해서', '통해', '통해서', '따라', '따라서',
    '관련', '관련해', '관련해서', '관련된', '관해', '관해서',
    '위', '아래', '앞', '뒤', '안', '밖', '속', '옆', '사이', '중간',
    '경우', '경우에', '경우는', '때문', '때문에', '덕분', '덕분에', '탓', '탓에',
    '이후', '이전', '동안', '사이', '중', '내', '외',

    // ============================================
    // 일반적인 서술어 (Common Predicates)
    // ============================================
    '생각', '생각에', '생각이', '생각을', '생각해', '생각했', '생각하면', '생각합니다',
    '느낌', '느낌이', '느낌을', '느껴', '느꼈', '느끼면',
    '기분', '기분이', '기분을', '마음', '마음이', '마음을',
    '감사', '감사해요', '감사합니다', '고마워요', '고맙습니다',
    '부탁', '부탁해요', '부탁합니다', '부탁드려요', '부탁드립니다',
    '안녕', '안녕하세요', '안녕하십니까', '안녕히',
    '반갑', '반가워요', '반갑습니다',
    '죄송', '죄송해요', '죄송합니다', '미안', '미안해요', '미안합니다',
    '궁금', '궁금해요', '궁금합니다', '궁금한',

    // ============================================
    // 흔한 문장 시작/끝 (Common Sentence Starters/Enders)
    // ============================================
    '글을', '글에', '글이', '것을', '것이', '것은', '것도', '것에', '것과',
    '거를', '거예요', '거에요', '거야', '건데', '건가요', '건데요',
    '수도', '수가', '수는', '수를', '수만', '수도요',
    '거나', '든가', '든지', '건지', '런지', '는지', 'ㄴ지', '을지', 'ㄹ지',
    '지만', '는데', 'ㄴ데', '니까', '으니까', '어서', '아서', '려고', '으려고',
    '에요', '이에요', '예요', '네요', '군요', '는군요', '는데요', '거든요', '잖아요',

    // ============================================
    // 감탄사 및 필러 (Interjections & Fillers)
    // ============================================
    '아', '어', '오', '음', '흠', '에', '네', '예', '응', '엉', '잉',
    '아아', '어어', '음음', '흠흠', '에에', '네네', '예예',
    '아니', '아뇨', '아니요', '아니에요', '아니라',
    '글쎄', '글쎄요', '뭐', '뭐요', '그래', '그래요', '그래서요',
    '진짜요', '정말요', '그렇군요', '그러네요', '그랬군요',
    '맞아', '맞아요', '맞습니다', '그렇죠', '그러게요', '그러니까요',

    // ============================================
    // 질문/응답 패턴 (Question/Answer Patterns)
    // ============================================
    '어떠세요', '어때요', '어때', '어떤가요', '어떤지', '어떻게요',
    '괜찮아요', '괜찮습니다', '좋아요', '좋습니다', '싫어요', '싫습니다',
    '알겠어요', '알겠습니다', '모르겠어요', '모르겠습니다',
    '그럴까요', '그럴게요', '그렇게요', '그러죠', '그럽시다',

    // ============================================
    // 단위 및 수량 (Units & Quantities)
    // ============================================
    '개', '명', '번', '가지', '종류', '정도', '쯤', '만큼', '처럼', '같이',
    '하나', '둘', '셋', '넷', '다섯', '여섯', '일곱', '여덟', '아홉', '열',
    '첫째', '둘째', '셋째', '한번', '두번', '세번', '몇번', '여러번',

    // ============================================
    // 기타 자주 쓰이는 표현 (Other Frequent Expressions)
    // ============================================
    '그렇게', '이렇게', '저렇게', '어떻게', '왜냐면', '그러면',
    '그래서요', '그러니까요', '그렇잖아요', '그런거죠', '그런건가요',
    '사실은', '원래', '원래는', '보통', '보통은', '일반적으로',
    '당연히', '물론이죠', '당연하죠', '그렇죠', '맞죠',
    '아무리', '제발', '꼭', '반드시', '필히',
]);

// Minimum word length
const MIN_WORD_LENGTH = 2;

// Maximum words to return
const MAX_KEYWORDS = 20;

export interface KeywordCount {
    keyword: string;
    count: number;
}

/**
 * Extract Korean words from text
 */
function extractKoreanWords(text: string): string[] {
    // Match Korean characters (Hangul) sequences of 2+ characters
    const regex = /[가-힣]{2,}/g;
    const matches = text.match(regex) || [];
    return matches.filter(word =>
        word.length >= MIN_WORD_LENGTH && !STOPWORDS.has(word)
    );
}

/**
 * Extract and count keywords from multiple texts
 */
export function extractKeywords(texts: string[]): KeywordCount[] {
    const wordCounts = new Map<string, number>();

    for (const text of texts) {
        if (!text) continue;

        const words = extractKoreanWords(text);
        for (const word of words) {
            wordCounts.set(word, (wordCounts.get(word) || 0) + 1);
        }
    }

    // Convert to array and sort by count
    const sorted = Array.from(wordCounts.entries())
        .map(([keyword, count]) => ({ keyword, count }))
        .sort((a, b) => b.count - a.count)
        .slice(0, MAX_KEYWORDS);

    return sorted;
}

/**
 * Get top N keywords from texts
 */
export function getTopKeywords(texts: string[], limit: number = 10): KeywordCount[] {
    return extractKeywords(texts).slice(0, limit);
}
